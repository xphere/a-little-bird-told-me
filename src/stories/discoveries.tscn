[gd_scene load_steps=10 format=2]

[ext_resource path="res://modules/action/action.gd" type="Script" id=1]
[ext_resource path="res://src/actions/dialog.gd" type="Script" id=2]
[ext_resource path="res://modules/action/sequential.gd" type="Script" id=3]
[ext_resource path="res://src/stories/discoveries.gd" type="Script" id=4]
[ext_resource path="res://modules/action/first-match.gd" type="Script" id=5]
[ext_resource path="res://modules/action/serial.gd" type="Script" id=6]
[ext_resource path="res://modules/action/branch.gd" type="Script" id=7]
[ext_resource path="res://modules/action/random.gd" type="Script" id=8]
[ext_resource path="res://src/actions/plan-action.gd" type="Script" id=9]

[node name="Discoveries" type="Node"]
script = ExtResource( 4 )

[node name="messages" type="Node" parent="."]
script = ExtResource( 3 )
loop = false

[node name="0" type="Node" parent="messages"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="messages/0"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "What's this in your leg?"

[node name="dialog#2" type="Node" parent="messages/0"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "A letter?"

[node name="dialog#3" type="Node" parent="messages/0"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "I'll leave it at the desk"

[node name="1" type="Node" parent="messages"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="messages/1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Another message? Let's see..."

[node name="noop" type="Node" parent="messages"]
script = ExtResource( 1 )

[node name="inn-waiter" type="Node" parent="."]

[node name="agreement" type="Node" parent="inn-waiter"]
script = ExtResource( 5 )

[node name="0" type="Node" parent="inn-waiter/agreement"]
script = ExtResource( 3 )
loop = false

[node name="dialog#1" type="Node" parent="inn-waiter/agreement/0"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Looks like they had an \"agreement\" with the previous maester."

[node name="dialog#2" type="Node" parent="inn-waiter/agreement/0"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "I wonder what kind of deal are we talking about."

[node name="bar" type="Node" parent="."]
script = ExtResource( 5 )

[node name="all" type="Node" parent="bar"]
script = ExtResource( 7 )
expression_contents = "discovery.value == \"bar\" and context_flag(\"bar\", \"description\")"

[node name="sequential#1" type="Node" parent="bar/all"]
script = ExtResource( 3 )
loop = false

[node name="dialog#1" type="Node" parent="bar/all/sequential#1"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="bar/all/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Oh... Burn After Reading... B.A.R. Now I understand."

[node name="plan#1" type="Node" parent="bar/all/sequential#1/dialog#1"]
script = ExtResource( 9 )

[node name="dialog#1" type="Node" parent="bar/all/sequential#1/dialog#1/plan#1"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="bar/all/sequential#1/dialog#1/plan#1/dialog#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "I wonder if I should worry about burning those messages..."

[node name="dialog#2" type="Node" parent="bar/all/sequential#1/dialog#1/plan#1/dialog#1"]
script = ExtResource( 2 )
speaker = "assistant"
dialog = "Believe me, you don't want to."

[node name="dialog#2" type="Node" parent="bar/all/sequential#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Burn After Reading"

[node name="dialog#3" type="Node" parent="bar/all/sequential#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "I can't keep that promise. But I know how to keep a secret."

[node name="description" type="Node" parent="bar"]
script = ExtResource( 7 )
expression_contents = "context_flag(\"bar\", \"description\")"

[node name="sequential#1" type="Node" parent="bar/description"]
script = ExtResource( 3 )
loop = false

[node name="dialog#1" type="Node" parent="bar/description/sequential#1"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="bar/description/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "An order to burn the letter after reading.
So you can keep your secrets more secret."

[node name="dialog#2" type="Node" parent="bar/description/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Where can I burn these letters?"

[node name="dialog#3" type="Node" parent="bar/description/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "assistant"
dialog = "Oh! Previous maester forbade it. After..."

[node name="dialog#4" type="Node" parent="bar/description/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "assistant"
dialog = "Well, she had her reasons."

[node name="dialog#5" type="Node" parent="bar/description/sequential#1/dialog#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "There goes our secrecy, down the drain."

[node name="dialog#2" type="Node" parent="bar/description/sequential#1"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "I can't keep that promise. But I know how to keep a secret."

[node name="acronym" type="Node" parent="bar"]
script = ExtResource( 3 )
loop = false

[node name="dialog#1" type="Node" parent="bar/acronym"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "B.A.R. I wonder who it is. Or what it means."

[node name="random" type="Node" parent="bar/acronym"]
script = ExtResource( 8 )

[node name="dialog#1" type="Node" parent="bar/acronym/random"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Beyond All Recognition?"

[node name="dialog#2" type="Node" parent="bar/acronym/random"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Bells Are Ringing?"

[node name="dialog#3" type="Node" parent="bar/acronym/random"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Blades And Roses?"

[node name="dialog#4" type="Node" parent="bar/acronym/random"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Bimonthly Activity Report?"

[node name="dialog#5" type="Node" parent="bar/acronym/random"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "Business Activity Register?"

[node name="innkeeper" type="Node" parent="."]

[node name="unlock" type="Node" parent="innkeeper"]
script = ExtResource( 3 )

[node name="ActionDialog" type="Node" parent="innkeeper/unlock"]
script = ExtResource( 2 )
speaker = "maester"
dialog = "You have unlocked the innkeeper."

[node name="aristocrats" type="Node" parent="."]

[node name="unlock" type="Node" parent="aristocrats"]
script = ExtResource( 6 )

[node name="dialog#1" type="Node" parent="aristocrats/unlock"]
script = ExtResource( 2 )
speaker = "Maese"
dialog = "What is this Order about?"

[node name="dialog#2" type="Node" parent="aristocrats/unlock"]
script = ExtResource( 2 )
speaker = "Maese"
dialog = "And why they are giving us money?"

[node name="dialog#3" type="Node" parent="aristocrats/unlock"]
script = ExtResource( 2 )
speaker = "Maese"
dialog = "I should answer back..."
